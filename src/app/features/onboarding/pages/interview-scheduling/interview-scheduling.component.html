<div class="interview-form-container" *ngIf='title === "create" || title === "edit"'>
    <div class="interview-form-card">
        <div class="form-header">
            <h2 class="form-title">{{title === 'create' ? 'Create Interview Scheduling' : 'Edit Interview Scheduling'}} </h2>
            <p class="form-subtitle">{{title === 'create' ? 'Schedule interview for candidates' : 'Modify interview scheduling details'}}</p>
        </div>

        <form class="section-form">

            <!-- Section 1: Interview Details -->
            <div class="form-section interview-details">
                <h3 class="section-heading">Interview Details</h3>
                <div class="form-row">
                    <div class="form-group" *ngIf="isFieldActive('candidate')">
                        <label class="input-label">Candidate ID <span class="required">*</span></label>
                        <div class="custom-dropdown" (click)="toggleCandidateDropdown($event,'candidate')">
                            <div class="dropdown-selected">
                                <span>{{ selectedCandidate || 'Select Candidate' }}</span>
                                <i class="fa-solid fa-chevron-down dropdown-arrow"
                                    [class.rotate]="isCandidateDropdownOpen"></i>
                            </div>
                            <div class="dropdown-options" *ngIf="isCandidateDropdownOpen">
                                <div class="dropdown-option" *ngFor="let candidate of candidateOptions"
                                    (click)="selectCandidate(candidate, $event)">
                                    {{ candidate.firstName }} {{ candidate.lastName }}
                                </div>
                                <div *ngIf="candidateOptions.length === 0" class="dropdown-option text-muted">
                                    No Candidates Available
                                </div>
                            </div>
                        </div>
                         <div class="error-msg"
  *ngIf="isSubmitted && !interview.candidate">
  Required field is missing
</div>
                    </div>
                    <div class="form-group" *ngIf="isFieldActive('interview_date')">
                        <label class="input-label">Interview Date <span class="required">*</span></label>
                        <input type="date" class="form-input" [(ngModel)]="interview.interview_date"
                            name="interview_date" required />
                             <div class="error-msg"
  *ngIf="isSubmitted && !interview.interview_date">
  Required field is missing
</div>

                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group" *ngIf="isFieldActive('interview_start_time')">
                        <label class="input-label">Interview Start Time <span class="required">*</span></label>
                        <input type="time" class="form-input" [(ngModel)]="interview.start_time" name="start_time"
                            required />
                             <div class="error-msg"
  *ngIf="isSubmitted && !interview.start_time">
  Required field is missing
</div>
                    </div>
                    <div class="form-group" *ngIf="isFieldActive('interview_location')">
                        <label class="input-label">Interview Location <span class="required">*</span></label>
                        <div class="custom-dropdown" (click)="toggleLocationDropdown($event)">
                            <div class="dropdown-selected">
                                <span>{{ interview.location || 'Select Location' }}</span>
                                <i class="fa-solid fa-chevron-down dropdown-arrow"
                                    [class.rotate]="isLocationDropdownOpen"></i>
                            </div>
                            <div class="dropdown-options" *ngIf="isLocationDropdownOpen">
                                <div class="dropdown-option" *ngFor="let location of locationOptions"
                                    (click)="selectLocation(location, $event)">
                                    {{ location }}
                                </div>
                                <div *ngIf="locationOptions.length === 0" class="dropdown-option text-muted">
                                    No Locations Available
                                </div>
                            </div>
                        </div>
                         <div class="error-msg"
  *ngIf="isSubmitted && !interview.location">
  Required field is missing
</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group" *ngIf="isFieldActive('meeting_url')">
                        <label class="input-label">Meeting URL</label>
                        <input type="text" class="form-input" [(ngModel)]="interview.meeting_url" name="meeting_url"
                            placeholder="https://meet.google.com/abc-xyz" />

                    </div>
                    <div class="form-group" *ngIf="isFieldActive('interviewer')">
                        <label class="input-label">Interviewer <span class="required">*</span></label>
                        <div class="custom-dropdown" (click)="toggleInterviewerDropdown($event)">
                            <div class="dropdown-selected">
                                <span>{{ selectedInterviewerDisplay || 'Select Interviewer' }}</span>
                                <i class="fa-solid fa-chevron-down dropdown-arrow"
                                    [class.rotate]="isInterviewerDropdownOpen"></i>
                            </div>
                            <div class="dropdown-options" *ngIf="isInterviewerDropdownOpen">
                                <div class="dropdown-option" *ngFor="let interviewer of interviewerOptions"
                                    (click)="selectInterviewer(interviewer, $event)">
                                    {{ interviewer.name }} - {{ interviewer.department }}
                                </div>
                                <div *ngIf="interviewerOptions.length === 0" class="dropdown-option text-muted">
                                    No Interviewers Available
                                </div>
                            </div>
                        </div>
                         <div class="error-msg"
  *ngIf="isSubmitted && !interview.interviewer_user">
  Required field is missing
</div>
                    </div>
                </div>
                <div class="form-row">
                    <!-- <div class="form-group" *ngIf="isFieldActive('interview_status')">
                        <label class="input-label">Interview Status <span class="required">*</span></label>
                        <div class="custom-dropdown" (click)="toggleStatusDropdown($event)">
                            <div class="dropdown-selected">
                                <span>{{ interview.interview_status || 'Select Status' }}</span>
                                <i class="fa-solid fa-chevron-down dropdown-arrow"
                                    [class.rotate]="isStatusDropdownOpen"></i>
                            </div>
                            <div class="dropdown-options" *ngIf="isStatusDropdownOpen">
                                <div class="dropdown-option" *ngFor="let status of statusOptions"
                                    (click)="selectStatus(status, $event)">
                                    {{ status }}
                                </div>
                                <div *ngIf="statusOptions.length === 0" class="dropdown-option text-muted">
                                    No Interview Status Available
                                </div>
                            </div>
                        </div>
                         <div class="error-msg"
  *ngIf="isSubmitted && !interview.interview_status">
  Required field is missing
</div>
                    </div> -->
                </div>
            </div>

            <!-- Section 2: Remarks -->
            <div class="form-section remarks-section">
                <div class="form-row full-width" *ngIf="isFieldActive('remarks')">
                    <div class="form-group full-width">
                        <label class="input-label">Remarks</label>
                        <textarea class="form-textarea" [(ngModel)]="interview.remarks" name="remarks" rows="3"
                            placeholder="General remarks about the interview..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Dynamic Fields Section -->
            <div class="dynamic-fields-section"
                *ngIf="dynamicFieldsService.dynamicFields.length > 0 && (!sidebarTabs.length || activeTabId === 1)">
                <h3 class="section-heading">Additional Information</h3>
                <div class="form-row">
                    <ng-container *ngFor="let field of dynamicFieldsService.dynamicFields">
                        <div class="form-group" *ngIf="field.active">
                            <label class="input-label">
                                {{ field.label }}
                                <span class="required" *ngIf="field.required">*</span>
                            </label>

                            <!-- String Input -->
                            <input *ngIf="field.fieldType === 'STRING'" type="text" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode" [attr.maxlength]="field.maxLength">

                            <!-- Number Input -->
                            <input *ngIf="field.fieldType === 'NUMBER'" type="number" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">
                            <!-- DECIMAL Input -->

                            <input *ngIf="field.fieldType === 'DECIMAL'" type="number" step="any" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">

                            <!-- Date Input -->
                            <input *ngIf="field.fieldType === 'DATE'" type="date" class="form-input"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">

                            <!-- Email Input -->
                            <input *ngIf="field.fieldType === 'EMAIL'" type="email" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">

                            <!-- Phone Input -->
                            <input *ngIf="field.fieldType === 'PHONE'" type="tel" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">

                            <!-- URL Input -->
                            <input *ngIf="field.fieldType === 'URL'" type="url" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">

                            <!-- Textarea -->
                            <textarea *ngIf="field.fieldType === 'TEXTAREA'" class="form-textarea" rows="3"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode" [attr.maxlength]="field.maxLength"></textarea>

                            <!-- Boolean Checkbox -->
                            <div *ngIf="field.fieldType === 'BOOLEAN'" class="form-check">
                                <input class="form-check-input" type="checkbox"
                                    [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                    [id]="'dynamic_' + field.fieldCode" [name]="field.fieldCode">
                                <label class="form-check-label" [for]="'dynamic_' + field.fieldCode">
                                    {{ field.label }}
                                </label>
                            </div>

                            <!-- Lookup Table Dropdown -->
                            <div *ngIf="field.fieldType === 'LOOKUP_TABLE'" class="custom-dropdown">
                                <div class="dropdown-selected"
                                    (click)="dynamicFieldsService.toggleDynamicDropdown(field, $event)">
                                    <span>{{ dynamicFieldsService.getSelectedDisplayText(field) }}</span>
                                    <i class="fa-solid fa-chevron-down dropdown-arrow"
                                        [class.rotate]="field.isDropdownOpen"></i>
                                </div>
                                <div class="dropdown-options" *ngIf="field.isDropdownOpen">
                                    <div class="dropdown-option" *ngFor="let option of field.options"
                                        (click)="dynamicFieldsService.selectDynamicOption(field, option, $event)">
                                        {{ option.displayText || option.name || option }}
                                    </div>
                                    <div class="dropdown-option text-muted"
                                        *ngIf="!field.options || field.options.length === 0">
                                        No options available
                                    </div>
                                </div>
                            </div>

                            <!-- Lookup Enum Dropdown -->
                            <div *ngIf="field.fieldType === 'LOOKUP_ENUM'" class="custom-dropdown">
                                <div class="dropdown-selected"
                                    (click)="dynamicFieldsService.toggleDynamicDropdown(field, $event)">
                                    <span>{{ dynamicFieldsService.dynamicFieldsData[field.fieldCode] || 'Select ' +
                                        field.label }}</span>
                                    <i class="fa-solid fa-chevron-down dropdown-arrow"
                                        [class.rotate]="field.isDropdownOpen"></i>
                                </div>
                                <div class="dropdown-options" *ngIf="field.isDropdownOpen">
                                    <div class="dropdown-option" *ngFor="let enumValue of field.enumValues"
                                        (click)="dynamicFieldsService.selectDynamicOption(field, enumValue, $event)">
                                        {{ enumValue }}
                                    </div>
                                    <div class="dropdown-option text-muted"
                                        *ngIf="!field.enumValues || field.enumValues.length === 0">
                                        No options available
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
            <!-- Horizontal Tabs for ROW fields -->
            <div class="horizontal-tabs" *ngIf="sidebarTabs.length > 0">
                <div class="tabs-container">
                    <button *ngFor="let tab of sidebarTabs" class="tab-button" [class.active]="activeTabId === tab.id"
                        (click)="setActiveTab(tab.id)">
                        {{ tab.name }}
                    </button>
                </div>
            </div>
            <!-- ROW TABLE TABS Content -->
            <div *ngIf="sidebarTabs[activeTabId - 1]?.rowTableField" class="form-section tab-content-section">
                <form class="section-form">
                    <h3 class="section-heading">{{ sidebarTabs[activeTabId - 1]?.name }}</h3>
                    <div class="alert alert-warning"
                        *ngIf="!sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns || sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns.length === 0">
                        <i class="fa fa-exclamation-triangle"></i> No row columns found for this table.
                    </div>
                    <div class="form-row"
                        *ngIf="sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns && sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns.length > 0">
                        <ng-container *ngFor="let column of sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns">
                            <div class="form-group">
                                <label class="input-label">
                                    {{ column.label || column.name }}
                                    <span class="required" *ngIf="column.required">*</span>
                                </label>
                                <!-- String Input -->
                                <input *ngIf="column.fieldType === 'STRING'" type="text" class="form-input"
                                    [placeholder]="'Enter ' + (column.label || column.name)"
                                    [(ngModel)]="column.selectedValue" [name]="column.fieldCode"
                                    [attr.maxlength]="column.maxLength">
                                <!-- Number Input -->
                                <input *ngIf="column.fieldType === 'NUMBER'" type="number" class="form-input"
                                    [placeholder]="'Enter ' + (column.label || column.name)"
                                    [(ngModel)]="column.selectedValue" [name]="column.fieldCode">
                                <!-- DECIMAL Input -->

                                <input *ngIf="column.fieldType === 'DECIMAL'" type="number" step="any"
                                    class="form-input" [placeholder]="'Enter ' + (column.label || column.name)"
                                    [(ngModel)]="column.selectedValue" [name]="column.fieldCode">
                                <!-- Date Input -->
                                <input *ngIf="column.fieldType === 'DATE'" type="date" class="form-input"
                                    [(ngModel)]="column.selectedValue" [name]="column.fieldCode">
                                <!-- Email Input -->
                                <input *ngIf="column.fieldType === 'EMAIL'" type="email" class="form-input"
                                    [placeholder]="'Enter ' + (column.label || column.name)"
                                    [(ngModel)]="column.selectedValue" [name]="column.fieldCode">
                                <!-- Phone Input -->
                                <input *ngIf="column.fieldType === 'PHONE'" type="tel" class="form-input"
                                    [placeholder]="'Enter ' + (column.label || column.name)"
                                    [(ngModel)]="column.selectedValue" [name]="column.fieldCode">
                                <!-- URL Input -->
                                <input *ngIf="column.fieldType === 'URL'" type="url" class="form-input"
                                    [placeholder]="'Enter ' + (column.label || column.name)"
                                    [(ngModel)]="column.selectedValue" [name]="column.fieldCode">
                                <!-- Textarea -->
                                <textarea *ngIf="column.fieldType === 'TEXTAREA'" class="form-input" rows="3"
                                    [placeholder]="'Enter ' + (column.label || column.name)"
                                    [(ngModel)]="column.selectedValue" [name]="column.fieldCode"
                                    [attr.maxlength]="column.maxLength"></textarea>
                                <!-- Boolean Checkbox -->
                                <div *ngIf="column.fieldType === 'BOOLEAN'" class="checkbox-label">
                                    <input class="checkbox-input" type="checkbox" [(ngModel)]="column.selectedValue"
                                        [name]="column.fieldCode" [id]="'row_' + column.fieldCode">
                                    <span class="checkbox-text">{{ column.label }}</span>
                                </div>
                                <!-- Lookup Table Dropdown -->
                                <div *ngIf="column.fieldType === 'LOOKUP_TABLE'" class="custom-dropdown">
                                    <div class="dropdown-selected"
                                        (click)="dynamicFieldsService.toggleRowColumnDropdown(column, $event)">
                                        <span>{{ dynamicFieldsService.getRowColumnDisplayText(column) }}</span>
                                        <i class="fa-solid fa-chevron-down dropdown-arrow"
                                            [class.rotate]="column.isDropdownOpen"></i>
                                    </div>
                                    <div class="dropdown-options" *ngIf="column.isDropdownOpen">
                                        <div class="dropdown-option" *ngFor="let option of column.options"
                                            (click)="dynamicFieldsService.selectRowColumnOption(column, option, $event)">
                                            {{ option.displayText || option.name || option }}
                                        </div>
                                        <div class="dropdown-option text-muted"
                                            *ngIf="!column.options || column.options.length === 0">
                                            No options available
                                        </div>
                                    </div>
                                </div>
                                <!-- Lookup Enum Dropdown -->
                                <div *ngIf="column.fieldType === 'LOOKUP_ENUM'" class="custom-dropdown">
                                    <div class="dropdown-selected"
                                        (click)="dynamicFieldsService.toggleRowColumnDropdown(column, $event)">
                                        <span>{{ column.selectedValue || 'Select ' + (column.label || column.name)
                                            }}</span>
                                        <i class="fa-solid fa-chevron-down dropdown-arrow"
                                            [class.rotate]="column.isDropdownOpen"></i>
                                    </div>
                                    <div class="dropdown-options" *ngIf="column.isDropdownOpen">
                                        <div class="dropdown-option" *ngFor="let enumValue of column.enumValues"
                                            (click)="dynamicFieldsService.selectRowColumnOption(column, enumValue, $event)">
                                            {{ enumValue }}
                                        </div>
                                        <div class="dropdown-option text-muted"
                                            *ngIf="!column.enumValues || column.enumValues.length === 0">
                                            No options available
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </form>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="button" class="btn btn-cancel" (click)="onCancel()">
                    Cancel
                </button>

                <button type="submit" class="btn btn-submit" (click)="saveInterview()">
                    <i class="fa-solid fa-calendar-check"></i>
                    {{title === 'create' ? 'Schedule Interview' : 'Update Interview'}}
                </button>
            </div>
        </form>
    </div>
</div>

<div *ngIf='title === "view"'>


  <section class="container-fluid p-0">
    <div class="d-flex justify-content-between mb-3">
      <div class="page-title ">
        <i class="fa-solid fa-house"></i>
        <span style="font-weight: 700; color: #566f9e;">-</span>
        <span>View All Interview Schedules</span>
      </div>

      <!-- Items Per Page + Search -->
      <div class="top-controls d-flex align-items-center">

        <!-- Items Per Page -->
        <!-- <div class="items-per-page">
          <label>Items per page:</label>
          <select class="form-select" [(ngModel)]="itemsPerPage" (change)="onItemsPerChange($event)">
            <option [ngValue]="5">5</option>
            <option [ngValue]="8">8</option>
            <option [ngValue]="10">10</option>
            <option [ngValue]="20">20</option>
          </select>
        </div> -->
        <!-- Search -->
        <!-- Search -->
        <!-- <div class="search-wrapper ms-auto">
          <input type="text" class="form-control" placeholder="Search..." (ngModelChange)="updatePagination()" />
          <i class="fa fa-search search-icon"></i>
        </div> -->
      </div>

      <div>
        <button routerLink="/panel/onboarding/create-new-interview-scheduling" class="creat-btn">Create Interview Scheduling</button>
      </div>
    </div>
    <section class="table-main-div ">
      <div class="rounded-2xl text-gray-200 overflow-x-auto pt-4">
        <table class="min-w-full text-sm border-separate border-spacing-y-2 ">
          <thead>
            <tr class="text-gray-400 text-left text-xs uppercase tracking-wider">

              <th class="px-3 py-2">Candidate Name</th>
              <th class="px-3 py-2">Interview Date</th>
              <th class="px-3 py-2">Time</th>
              <th class="px-3 py-2">Location</th>
              <th class="px-3 py-2">Department</th>
                <th class="px-3 py-2">Job Title</th>
              <th class="px-3 py-2">Actions</th>





            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let c of interviewTableListArray; let i = index"
              class="bg-[#1e293b] hover:bg-[#27354a] rounded-lg">
              <td class="px-3 py-3 font-medium">{{ c.candidateFirstName }} {{ c.candidateLastName }}</td>
              <td class="px-3 py-3 font-medium">{{ c.interviewDate|| '—' }}</td>
              <td class="px-3 py-3 font-medium">{{ c.startTime || '—'}}</td>
              <td class="px-3 py-3 font-medium">{{ c.interviewLocation || '—'}}</td>
              <td class="px-3 py-3 font-medium">{{ c.departmentName || '—'}}</td>
              <td class="px-3 py-3 font-medium">{{ c.jobTitleName || '—' }}</td>
              <td class="px-3 py-3 font-medium">
                <i class="fa fa-edit" style="cursor:pointer; margin-right: 10px;"
                  [routerLink]="['/panel/onboarding/edit-interview-scheduling']"
                  [queryParams]="{id: c.candidatePublicId ,currentPage:currentPage}"></i>
                <i class="fa fa-trash" style="cursor:pointer; " (click)="deleteInterview(c)"></i>
              </td>







            </tr>
          </tbody>
        </table>

      </div>

      <app-pagination [currentPage]="currentPage+1" [totalPages]="totalPages" [totalPagesArray]="totalPagesArray"
        (pageChange)="changePage($event)">
      </app-pagination>
    </section>
  </section>
</div>