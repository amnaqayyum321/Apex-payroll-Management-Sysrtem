<div class="req-form-container" *ngIf='title === "create" || title === "edit"'>
  <div class="req-form-card">
    <div class="form-header">
      <h2 class="form-title">{{formTitle}} </h2>
      <p class="form-subtitle">{{title === 'create' ? 'Define a new requisition request' : 'Edit requisition details'}}
      </p>
    </div>

    <form class="req-form">
      <!-- Row 1: Requisition Id & Name -->
      <div class="form-row">
        <!-- <div class="form-group">
          <label class="input-label">Requisition Id <span class="required">*</span></label>
          <input type="number" class="form-input" [(ngModel)]="requisition.requisitionId" name="requisitionId"
            placeholder="Enter Requisition Id" required />
        </div> -->

      </div>

      <!-- Row 2: Department & Job Title -->
      <div class="form-row">
        <div class="form-group" *ngIf="isFieldActive('requisition_name')">
          <label class="input-label">Requisition Name <span class="required">*</span></label>
          <input type="text" class="form-input" [(ngModel)]="requisition.requisition_name" name="requisitionName"
            placeholder="Enter Requisition Name" required />
          <div class="error-msg" *ngIf="isSubmitted && !requisition.requisition_name">
            Requisition Name is required
          </div>
        </div>
        <div class="form-group" *ngIf="isFieldActive('department')">
          <label class="input-label">Department <span class="required">*</span></label>
          <div class="custom-dropdown" (click)="toggleDropdown($event,'department')">
            <div class="dropdown-selected">
              <span>{{ departMentDropDownValue || 'Select Department' }}</span>
              <i class="fa-solid fa-chevron-down dropdown-arrow" [class.rotate]="activeDropdown==='department'"></i>
            </div>
            <div class="dropdown-options" *ngIf="activeDropdown==='department'">
              <div *ngIf="departments.length > 0">
                <div class="dropdown-option" *ngFor="let d of departments"
                  (click)="selectOption('department',d,$event)">
                  {{ d.name }}
                </div>
              </div>
              <div *ngIf="departments.length === 0" class="dropdown-option text-muted">
                No Departments Available
              </div>
            </div>
          </div>
          <div class="error-msg" *ngIf="isSubmitted && !requisition.department">
            Department is required
          </div>
        </div>

        <div class="form-group" *ngIf="isFieldActive('job_title')">
          <label class="input-label">Job Title <span class="required">*</span></label>
          <div class="custom-dropdown" (click)="toggleDropdown($event,'job_title')">
            <div class="dropdown-selected">
              <span>{{ jobTitleDropDownValue || 'Select Job Title' }}</span>
              <i class="fa-solid fa-chevron-down dropdown-arrow" [class.rotate]="activeDropdown==='job_title'"></i>
            </div>
            <div class="dropdown-options" *ngIf="activeDropdown==='job_title'">
              <div *ngIf="jobTitles.length > 0">
                <div class="dropdown-option" *ngFor="let j of jobTitles" (click)="selectOption('job_title',j,$event)">
                  {{ j.name }}
                </div>
              </div>
              <div *ngIf="jobTitles.length === 0" class="dropdown-option text-muted">
                No Job Titles Available
              </div>
            </div>
          </div>
          <div class="error-msg" *ngIf="isSubmitted && !requisition.job_title">
            Job Title is required
          </div>
        </div>
        <div class="form-group" *ngIf="isFieldActive('designation')">
          <label class="input-label">Designation <span class="required">*</span></label>
          <div class="custom-dropdown" (click)="toggleDropdown($event,'designation')">
            <div class="dropdown-selected">
              <span>{{ designationDropDownValue || 'Select Designation' }}</span>
              <i class="fa-solid fa-chevron-down dropdown-arrow" [class.rotate]="activeDropdown==='designation'"></i>
            </div>
            <div class="dropdown-options" *ngIf="activeDropdown==='designation'">
              <div *ngIf="designations.length > 0">
                <div class="dropdown-option" *ngFor="let d of designations"
                  (click)="selectOption('designation', d, $event)">
                  {{ d.name }}
                </div>
              </div>

              <div *ngIf="designations.length === 0" class="dropdown-option text-muted">
                No Designations Available
              </div>

            </div>
          </div>
          <div class="error-msg" *ngIf="isSubmitted && !requisition.designation">
            Designation is required
          </div>
        </div>

      </div>

      <!-- Row 3: Designation & No of Employees -->
      <div class="form-row">

        <div class="form-group" *ngIf="isFieldActive('required_count')">
          <label class="input-label">No Of Employees Required</label>
          <input type="number" class="form-input" [(ngModel)]="requisition.required_count" name="noOfEmployees"
            placeholder="e.g., 2" min="0" />
          <div class="error-msg" *ngIf="isSubmitted && !requisition.required_count">
            Required field is empty
          </div>
        </div>
        <div class="form-group" *ngIf="isFieldActive('hiring_manager')">
          <label class="input-label">Hiring Manager <span class="required">*</span></label>
          <div class="custom-dropdown" (click)="toggleDropdown($event,'hiringManager')">
            <div class="dropdown-selected">
              <span>{{ requisition.hiring_manager || 'Select Hiring Manager' }}</span>
              <i class="fa-solid fa-chevron-down dropdown-arrow" [class.rotate]="activeDropdown==='hiringManager'"></i>
            </div>
            <div class="dropdown-options" *ngIf="activeDropdown==='hiringManager'">
              <div class="dropdown-option" *ngFor="let h of hiringManagers"
                (click)="selectHiringManager('hiring_manager',h,$event)">{{ h }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Row 4: Required Date & Job Description -->
      <div class="form-row">
        <div class="form-group" *ngIf="isFieldActive('required_date')">
          <label class="input-label">Required Date <span class="required">*</span></label>
          <input type="date" class="form-input" [(ngModel)]="requisition.required_date" name="requiredDate" required />
          <div class="error-msg" *ngIf="isSubmitted && !requisition.required_date">
            Required field is empty
          </div>
        </div>
        <div class="form-row" *ngIf="isFieldActive('is_active')">
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" class="checkbox-input" [(ngModel)]="requisition.is_active" name="status" />
              <span class="checkbox-text">Active</span>
            </label>
          </div>
        </div>

      </div>

      <!-- Row 5: Hiring Manager & Status -->

      <div class="form-row full-width" *ngIf="isFieldActive('job_description')">
        <div class="form-group full-width">
          <label class="input-label">Description</label>
          <textarea class="form-input" [(ngModel)]="requisition.job_description" name="description" rows="4"
            placeholder="Enter role description"></textarea>
        </div>
      </div>



      <!-- Dynamic Fields Section -->
      <div class="dynamic-fields-section"
        *ngIf="dynamicFieldsService.dynamicFields.length > 0 && (!sidebarTabs.length || activeTabId === 1)">
        <h3 class="section-heading">Additional Information</h3>
        <div class="form-row">
          <ng-container *ngFor="let field of dynamicFieldsService.dynamicFields">
            <div class="form-group" *ngIf="field.active">
              <label class="input-label">
                {{ field.label }}
                <span class="required" *ngIf="field.required">*</span>
              </label>

              <!-- String Input -->
              <input *ngIf="field.fieldType === 'STRING'" type="text" class="form-input"
                [placeholder]="'Enter ' + field.label"
                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]" [name]="field.fieldCode"
                [attr.maxlength]="field.maxLength">

              <!-- Number Input -->
              <input *ngIf="field.fieldType === 'NUMBER'" type="number" class="form-input"
                [placeholder]="'Enter ' + field.label"
                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]" [name]="field.fieldCode">
              <!-- DECIMAL Input -->

              <input *ngIf="field.fieldType === 'DECIMAL'" type="number" step="any" class="form-input"
                [placeholder]="'Enter ' + field.label"
                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]" [name]="field.fieldCode">

              <!-- Date Input -->
              <input *ngIf="field.fieldType === 'DATE'" type="date" class="form-input"
                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]" [name]="field.fieldCode">

              <!-- Email Input -->
              <input *ngIf="field.fieldType === 'EMAIL'" type="email" class="form-input"
                [placeholder]="'Enter ' + field.label"
                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]" [name]="field.fieldCode">

              <!-- Phone Input -->
              <input *ngIf="field.fieldType === 'PHONE'" type="tel" class="form-input"
                [placeholder]="'Enter ' + field.label"
                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]" [name]="field.fieldCode">

              <!-- URL Input -->
              <input *ngIf="field.fieldType === 'URL'" type="url" class="form-input"
                [placeholder]="'Enter ' + field.label"
                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]" [name]="field.fieldCode">

              <!-- Textarea -->
              <textarea *ngIf="field.fieldType === 'TEXTAREA'" class="form-input" rows="3"
                [placeholder]="'Enter ' + field.label"
                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]" [name]="field.fieldCode"
                [attr.maxlength]="field.maxLength"></textarea>

              <!-- Boolean Checkbox -->
              <div *ngIf="field.fieldType === 'BOOLEAN'" class="form-check">
                <input class="form-check-input" type="checkbox"
                  [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                  [id]="'dynamic_' + field.fieldCode" [name]="field.fieldCode">
                <label class="form-check-label" [for]="'dynamic_' + field.fieldCode">
                  {{ field.label }}
                </label>
              </div>

              <!-- Lookup Table Dropdown -->
              <div *ngIf="field.fieldType === 'LOOKUP_TABLE'" class="custom-dropdown">
                <div class="dropdown-selected" (click)="dynamicFieldsService.toggleDynamicDropdown(field, $event)">
                  <span>{{ dynamicFieldsService.getSelectedDisplayText(field) }}</span>
                  <i class="fa-solid fa-chevron-down dropdown-arrow" [class.rotate]="field.isDropdownOpen"></i>
                </div>
                <div class="dropdown-options" *ngIf="field.isDropdownOpen">
                  <div class="dropdown-option" *ngFor="let option of field.options"
                    (click)="dynamicFieldsService.selectDynamicOption(field, option, $event)">
                    {{ option.displayText || option.name || option }}
                  </div>
                  <div class="dropdown-option text-muted" *ngIf="!field.options || field.options.length === 0">
                    No options available
                  </div>
                </div>
              </div>

              <!-- Lookup Enum Dropdown -->
              <div *ngIf="field.fieldType === 'LOOKUP_ENUM'" class="custom-dropdown">
                <div class="dropdown-selected" (click)="dynamicFieldsService.toggleDynamicDropdown(field, $event)">
                  <span>{{ dynamicFieldsService.dynamicFieldsData[field.fieldCode] || 'Select ' +
                    field.label }}</span>
                  <i class="fa-solid fa-chevron-down dropdown-arrow" [class.rotate]="field.isDropdownOpen"></i>
                </div>
                <div class="dropdown-options" *ngIf="field.isDropdownOpen">
                  <div class="dropdown-option" *ngFor="let enumValue of field.enumValues"
                    (click)="dynamicFieldsService.selectDynamicOption(field, enumValue, $event)">
                    {{ enumValue }}
                  </div>
                  <div class="dropdown-option text-muted" *ngIf="!field.enumValues || field.enumValues.length === 0">
                    No options available
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- Horizontal Tabs for ROW fields -->
      <div class="horizontal-tabs" *ngIf="sidebarTabs.length > 0">
        <div class="tabs-container">
          <button *ngFor="let tab of sidebarTabs" class="tab-button" [class.active]="activeTabId === tab.id"
            (click)="setActiveTab(tab.id)">
            {{ tab.name }}
          </button>
        </div>
      </div>
      <!-- ROW TABLE TABS Content -->
      <div *ngIf="sidebarTabs[activeTabId - 1]?.rowTableField" class="form-section tab-content-section">
        <form class="section-form">
          <h3 class="section-heading">{{ sidebarTabs[activeTabId - 1]?.name }}</h3>

          <div class="alert alert-warning"
            *ngIf="!sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns || sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns.length === 0">
            <i class="fa fa-exclamation-triangle"></i> No row columns found for this table.
          </div>

          <div class="form-row"
            *ngIf="sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns && sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns.length > 0">
            <ng-container *ngFor="let column of sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns">
              <div class="form-group">
                <label class="input-label">
                  {{ column.label || column.name }}
                  <span class="required" *ngIf="column.required">*</span>
                </label>

                <!-- String Input -->
                <input *ngIf="column.fieldType === 'STRING'" type="text" class="form-input"
                  [placeholder]="'Enter ' + (column.label || column.name)" [(ngModel)]="column.selectedValue"
                  [name]="column.fieldCode" [attr.maxlength]="column.maxLength">

                <!-- Number Input -->
                <input *ngIf="column.fieldType === 'NUMBER'" type="number" class="form-input"
                  [placeholder]="'Enter ' + (column.label || column.name)" [(ngModel)]="column.selectedValue"
                  [name]="column.fieldCode">
                <!-- DECIMAL Input -->

                <input *ngIf="column.fieldType === 'DECIMAL'" type="number" step="any" class="form-input"
                  [placeholder]="'Enter ' + (column.label || column.name)" [(ngModel)]="column.selectedValue"
                  [name]="column.fieldCode">

                <!-- Date Input -->
                <input *ngIf="column.fieldType === 'DATE'" type="date" class="form-input"
                  [(ngModel)]="column.selectedValue" [name]="column.fieldCode">

                <!-- Email Input -->
                <input *ngIf="column.fieldType === 'EMAIL'" type="email" class="form-input"
                  [placeholder]="'Enter ' + (column.label || column.name)" [(ngModel)]="column.selectedValue"
                  [name]="column.fieldCode">

                <!-- Phone Input -->
                <input *ngIf="column.fieldType === 'PHONE'" type="tel" class="form-input"
                  [placeholder]="'Enter ' + (column.label || column.name)" [(ngModel)]="column.selectedValue"
                  [name]="column.fieldCode">

                <!-- URL Input -->
                <input *ngIf="column.fieldType === 'URL'" type="url" class="form-input"
                  [placeholder]="'Enter ' + (column.label || column.name)" [(ngModel)]="column.selectedValue"
                  [name]="column.fieldCode">

                <!-- Textarea -->
                <textarea *ngIf="column.fieldType === 'TEXTAREA'" class="form-input" rows="3"
                  [placeholder]="'Enter ' + (column.label || column.name)" [(ngModel)]="column.selectedValue"
                  [name]="column.fieldCode" [attr.maxlength]="column.maxLength"></textarea>

                <!-- Boolean Checkbox -->
                <div *ngIf="column.fieldType === 'BOOLEAN'" class="checkbox-label">
                  <input class="checkbox-input" type="checkbox" [(ngModel)]="column.selectedValue"
                    [name]="column.fieldCode" [id]="'row_' + column.fieldCode">
                  <span class="checkbox-text">{{ column.label }}</span>
                </div>

                <!-- Lookup Table Dropdown -->
                <div *ngIf="column.fieldType === 'LOOKUP_TABLE'" class="custom-dropdown">
                  <div class="dropdown-selected" (click)="dynamicFieldsService.toggleRowColumnDropdown(column, $event)">
                    <span>{{ dynamicFieldsService.getRowColumnDisplayText(column) }}</span>
                    <i class="fa-solid fa-chevron-down dropdown-arrow" [class.rotate]="column.isDropdownOpen"></i>
                  </div>
                  <div class="dropdown-options" *ngIf="column.isDropdownOpen">
                    <div class="dropdown-option" *ngFor="let option of column.options"
                      (click)="dynamicFieldsService.selectRowColumnOption(column, option, $event)">
                      {{ option.displayText || option.name || option }}
                    </div>
                    <div class="dropdown-option text-muted" *ngIf="!column.options || column.options.length === 0">
                      No options available
                    </div>
                  </div>
                </div>

                <!-- Lookup Enum Dropdown -->
                <div *ngIf="column.fieldType === 'LOOKUP_ENUM'" class="custom-dropdown">
                  <div class="dropdown-selected" (click)="dynamicFieldsService.toggleRowColumnDropdown(column, $event)">
                    <span>{{ column.selectedValue || 'Select ' + (column.label || column.name) }}</span>
                    <i class="fa-solid fa-chevron-down dropdown-arrow" [class.rotate]="column.isDropdownOpen"></i>
                  </div>
                  <div class="dropdown-options" *ngIf="column.isDropdownOpen">
                    <div class="dropdown-option" *ngFor="let enumValue of column.enumValues"
                      (click)="dynamicFieldsService.selectRowColumnOption(column, enumValue, $event)">
                      {{ enumValue }}
                    </div>
                    <div class="dropdown-option text-muted"
                      *ngIf="!column.enumValues || column.enumValues.length === 0">
                      No options available
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </form>
      </div>
      <!-- Action Buttons -->
      <div class="form-actions">
        <button type="button" class="btn btn-cancel" (click)="onCancel()">
          Cancel
        </button>
        <button type="submit" class="btn btn-submit" (click)="saveRequisition()">{{title === 'create' ? 'Create
          Requisition' : (title === 'edit' ? 'Update Requisition' : '')}} </button>
      </div>
    </form>
  </div>



</div>

<div *ngIf='title === "view"'>


  <section class="container-fluid p-0">
    <div class="d-flex justify-content-between mb-3">
      <div class="page-title ">
        <i class="fa-solid fa-house"></i>
        <span style="font-weight: 700; color: #566f9e;">-</span>
        <span>View All Requisitions List</span>
      </div>

      <!-- Items Per Page + Search -->
      <div class="top-controls d-flex align-items-center">

        <!-- Items Per Page -->
        <!-- <div class="items-per-page">
          <label>Items per page:</label>
          <select class="form-select" [(ngModel)]="itemsPerPage" (change)="onItemsPerChange($event)">
            <option [ngValue]="5">5</option>
            <option [ngValue]="8">8</option>
            <option [ngValue]="10">10</option>
            <option [ngValue]="20">20</option>
          </select>
        </div> -->
        <!-- Search -->
        <!-- Search -->
        <!-- <div class="search-wrapper ms-auto">
          <input type="text" class="form-control" placeholder="Search..." (ngModelChange)="updatePagination()" />
          <i class="fa fa-search search-icon"></i>
        </div> -->
      </div>

      <div>
        <button routerLink="/panel/onboarding/create-new-requisition" class="creat-btn">Create Requisition</button>
      </div>
    </div>
    <section class="table-main-div ">
      <div class="rounded-2xl text-gray-200 overflow-x-auto pt-4">
        <table class="min-w-full text-sm border-separate border-spacing-y-2 ">
          <thead>
            <tr class="text-gray-400 text-left text-xs uppercase tracking-wider">

              <th class="px-3 py-2">Requisitioname</th>
              <th class="px-3 py-2">Department</th>
              <th class="px-3 py-2">Job Title</th>
              <th class="px-3 py-2">Designation</th>
              <th class="px-3 py-2">Active</th>
              <th class="px-3 py-2">Actions</th>





            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let c of jobRequisitionsArray; let i = index"
              class="bg-[#1e293b] hover:bg-[#27354a] rounded-lg">
              <td class="px-3 py-3 font-medium">{{ c.requisitionName || '—'}}</td>
              <td class="px-3 py-3 font-medium">{{ c.departmentName|| '—' }}</td>
              <td class="px-3 py-3 font-medium">{{ c.jobTitleName|| '—' }}</td>
              <td class="px-3 py-3 font-medium">{{ c.designationName|| '—' }}</td>
              <td class="px-3 py-3 font-medium">{{ c.isActive }}</td>
              <!-- <td class="px-3 py-3 font-medium">{{ c.actions }}</td>  -->
              <td class="px-3 py-3 font-medium">
                <i class="fa fa-edit" style="cursor:pointer; margin-right: 10px;"
                  [routerLink]="['/panel/onboarding/edit-requisition']"
                  [queryParams]="{id: c.publicId ,currentPage:currentPage}"></i>
                <i class="fa fa-trash" style="cursor:pointer;" (click)="deleteRequisition(c)"></i>
              </td>







            </tr>
          </tbody>
        </table>

      </div>

      <app-pagination [currentPage]="currentPage + 1" [totalPages]="totalPages" [totalPagesArray]="totalPagesArray"
        (pageChange)="changePage($event)">
      </app-pagination>
    </section>
  </section>
</div>