<div class="finalscreening-form-container">
    <div class="finalscreening-form-card">
        <div class="form-header">
            <h2 class="form-title">Final Screening</h2>
            <p class="form-subtitle">Define a new final screening</p>
        </div>

        <!-- Section 1: Candidate Info -->
        <div class="form-section finalscreening-info">
            <form class="section-form">
                <h3 class="section-heading">Candidate Information</h3>

                <div class="form-row">
                    <!-- <div class="form-group" *ngIf="isFieldActive('id')">
                        <label class="input-label">ID <span class="required">*</span></label>
                        <input type="number" class="form-input" [(ngModel)]="finalScreening.id" name="id" required />
                    </div> -->
                    <div class="form-group" *ngIf="isFieldActive('candidate_id')">
                        <label class="input-label">Candidate ID <span class="required">*</span></label>
                        <div class="custom-dropdown" (click)="toggleDropdown($event,'candidateId')">
                            <div class="dropdown-selected">
                                <span>
                                    {{ (selectedCandidateInfo.firstName && selectedCandidateInfo.lastName)
                                    ? (selectedCandidateInfo.firstName + '-' + selectedCandidateInfo.lastName)
                                    : 'Select Candidate ID' }}
                                </span>

                                <i class="fa-solid fa-chevron-down dropdown-arrow"
                                    [class.rotate]="activeDropdown==='candidateId'"></i>
                            </div>
                            <div class="dropdown-options" *ngIf="activeDropdown==='candidateId'">
                                <div class="dropdown-option" *ngFor="let id of candidateLisitng"
                                    (click)="selectOption('candidateId',id,$event)">
                                    {{ id.firstName + '-' + id.lastName }}
                                </div>
                                <div class="dropdown-option text-muted"
                                    *ngIf="!candidateLisitng || candidateLisitng.length === 0">
                                    No candidates available
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Section 2: Basic Information -->
        <div class="form-section basic-info">
            <div class="section-form">
                <h3 class="section-heading">Basic Information</h3>

                <section class="table-main-div ">
                    <div class="rounded-2xl text-gray-200 overflow-x-auto  pt-4">
                        <table class="min-w-full text-sm border-separate border-spacing-y-2 ">
                            <thead>
                                <tr class="text-gray-400 text-left text-xs uppercase tracking-wider">
                                    <th class="px-3 py-2">First Name</th>
                                    <th class="px-3 py-2">Last Name</th>
                                    <th class="px-3 py-2">Requisition</th>
                                    <th class="px-3 py-2">Email</th>
                                    <th class="px-3 py-2">Contract No 1</th>
                                    <th class="px-3 py-2">Contract No 2</th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr class="bg-[#1e293b] hover:bg-[#27354a] rounded-lg">
                                    <td class="px-3 py-3 font-medium"></td>
                                    <td class="px-3 py-3 font-medium"></td>
                                    <td class="px-3 py-3 font-medium"></td>
                                    <td class="px-3 py-3 text-gray-400"></td>
                                    <!-- <td class="px-3 py-3 text-gray-400">{{ user.phoneNumber }}</td> -->
                                    <td class="px-3 py-3 text-gray-400"></td>
                                    <td class="px-3 py-3 text-gray-400"></td>





                                </tr>
                            </tbody>
                        </table>

                    </div>


                </section>
            </div>
        </div>

        <!-- Section 3: Interview Details -->
        <div class="form-section interview-details">
            <form class="section-form">
                <h3 class="section-heading">Interview Details</h3>

                <section class="table-main-div ">
                    <div class="rounded-2xl text-gray-200 overflow-x-auto  pt-4">
                        <table class="min-w-full text-sm border-separate border-spacing-y-2 ">
                            <thead>
                                <tr class="text-gray-400 text-left text-xs uppercase tracking-wider">
                                    <th class="px-3 py-2">Interview ID</th>
                                    <th class="px-3 py-2">Interview Date</th>
                                    <th class="px-3 py-2">Interview Time</th>
                                    <th class="px-3 py-2">Status</th>
                                    <th class="px-3 py-2">Interviewer Name</th>
                                    <th class="px-3 py-2">Remarks</th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr class="bg-[#1e293b] hover:bg-[#27354a] rounded-lg">
                                    <td class="px-3 py-3 font-medium"></td>
                                    <td class="px-3 py-3 font-medium"></td>
                                    <td class="px-3 py-3 font-medium"></td>
                                    <td class="px-3 py-3 text-gray-400"></td>
                                    <!-- <td class="px-3 py-3 text-gray-400">{{ user.phoneNumber }}</td> -->
                                    <td class="px-3 py-3 text-gray-400"></td>
                                    <td class="px-3 py-3 text-gray-400"></td>





                                </tr>
                            </tbody>
                        </table>

                    </div>


                </section>
            </form>
        </div>

        <!-- Section 4: Final Decision -->
        <div class="form-section final-decision">
            <form class="section-form">
                <h3 class="section-heading">Final Decision</h3>

                <div class="form-row">
                    <div class="form-group" *ngIf="isFieldActive('final_status')">
                        <label class="input-label">Status <span class="required">*</span></label>
                        <div class="custom-dropdown" (click)="toggleDropdown($event,'finalStatus')">
                            <div class="dropdown-selected">
                                <span>{{ finalScreening.status || 'Select Status' }}</span>
                                <i class="fa-solid fa-chevron-down dropdown-arrow"
                                    [class.rotate]="activeDropdown==='finalStatus'"></i>
                            </div>
                            <div class="dropdown-options" *ngIf="activeDropdown==='finalStatus'">
                                <div class="dropdown-option" *ngFor="let status of finalStatuses"
                                    (click)="selectOption('finalStatus',status,$event)">
                                    {{ status }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" *ngIf="isFieldActive('doj')">
                        <label class="input-label">Date of Joining</label>
                        <input type="date" class="form-input" [(ngModel)]="finalScreening.DOJ" name="dateOfJoining" />
                    </div>
                </div>

                <div class="form-row full-width" *ngIf="isFieldActive('final_remarks')">
                    <div class="form-group">
                        <label class="input-label">Remarks</label>
                        <textarea class="form-input" [(ngModel)]="finalScreening.finalDeciosionRemarks"
                            name="finalRemarks" rows="3" placeholder="Enter final remarks"></textarea>
                    </div>
                </div>
            </form>
        </div>

        <!-- Section 5: Salary Details -->
        <!-- <div class="form-section salary-details">
            <form class="section-form">
                <h3 class="section-heading">Salary Details</h3>

                <div class="form-row">
                    <div class="form-group" *ngIf="isFieldActive('pay_element')">
                        <label class="input-label">Pay Element</label>
                        <div class="custom-dropdown" (click)="toggleDropdown($event,'payElement')">
                            <div class="dropdown-selected">
                                <span>{{ finalScreening.payElement || 'Select Pay Element' }}</span>
                                <i class="fa-solid fa-chevron-down dropdown-arrow"
                                    [class.rotate]="activeDropdown==='payElement'"></i>
                            </div>
                            <div class="dropdown-options" *ngIf="activeDropdown==='payElement'">
                                <div class="dropdown-option" *ngFor="let element of payElements"
                                    (click)="selectOption('payElement',element,$event)">
                                    {{ element }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" *ngIf="isFieldActive('effective_date')">
                        <label class="input-label">Effective Date</label>
                        <input type="date" class="form-input" [(ngModel)]="finalScreening.effectiveDate"
                            name="effectiveDate" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" *ngIf="isFieldActive('pay_frequency')">
                        <label class="input-label">Pay Frequency</label>
                        <div class="custom-dropdown" (click)="toggleDropdown($event,'payFrequency')">
                            <div class="dropdown-selected">
                                <span>{{ finalScreening.payFrequency || 'Select Frequency' }}</span>
                                <i class="fa-solid fa-chevron-down dropdown-arrow"
                                    [class.rotate]="activeDropdown==='payFrequency'"></i>
                            </div>
                            <div class="dropdown-options" *ngIf="activeDropdown==='payFrequency'">
                                <div class="dropdown-option" *ngFor="let freq of payFrequencies"
                                    (click)="selectOption('payFrequency',freq,$event)">
                                    {{ freq }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" *ngIf="isFieldActive('amount')">
                        <label class="input-label">Amount</label>
                        <input type="number" step="0.01" class="form-input" [(ngModel)]="finalScreening.amount"
                            name="amount" placeholder="0.00" />
                    </div>
                </div>

                <div class="form-row full-width" *ngIf="isFieldActive('salary_remarks')">
                    <div class="form-group">
                        <label class="input-label">Remarks</label>
                        <textarea class="form-input" [(ngModel)]="finalScreening.remarks" name="salaryRemarks" rows="3"
                            placeholder="Enter salary remarks"></textarea>
                    </div>
                </div>
            </form>
        </div> -->
        <!-- Dynamic Fields Section -->
        <div class="form-section dynamic-fields"
            *ngIf="dynamicFieldsService.dynamicFields.length > 0 && (!sidebarTabs.length || activeTabId === 1)">
            <form class="section-form">
                <h3 class="section-heading">Additional Information</h3>
                <div class="form-row">
                    <ng-container *ngFor="let field of dynamicFieldsService.dynamicFields">
                        <div class="form-group" *ngIf="field.active">
                            <label class="input-label">
                                {{ field.label }}
                                <span class="required" *ngIf="field.required">*</span>
                            </label>

                            <!-- String Input -->
                            <input *ngIf="field.fieldType === 'STRING'" type="text" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode" [attr.maxlength]="field.maxLength">

                            <!-- Number Input -->
                            <input *ngIf="field.fieldType === 'NUMBER'" type="number" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">
                            <!-- DECIMAL Input -->

                            <input *ngIf="field.fieldType === 'DECIMAL'" type="number" step="any" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">

                            <!-- Date Input -->
                            <input *ngIf="field.fieldType === 'DATE'" type="date" class="form-input"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">

                            <!-- Email Input -->
                            <input *ngIf="field.fieldType === 'EMAIL'" type="email" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">

                            <!-- Phone Input -->
                            <input *ngIf="field.fieldType === 'PHONE'" type="tel" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">

                            <!-- URL Input -->
                            <input *ngIf="field.fieldType === 'URL'" type="url" class="form-input"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode">

                            <!-- Textarea -->
                            <textarea *ngIf="field.fieldType === 'TEXTAREA'" class="form-input" rows="3"
                                [placeholder]="'Enter ' + field.label"
                                [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                [name]="field.fieldCode" [attr.maxlength]="field.maxLength"></textarea>

                            <!-- Boolean Checkbox -->
                            <div *ngIf="field.fieldType === 'BOOLEAN'" class="checkbox-label">
                                <input class="checkbox-input" type="checkbox"
                                    [(ngModel)]="dynamicFieldsService.dynamicFieldsData[field.fieldCode]"
                                    [id]="'dynamic_' + field.fieldCode" [name]="field.fieldCode">
                                <span class="checkbox-text">{{ field.label }}</span>
                            </div>

                            <!-- Lookup Table Dropdown -->
                            <div *ngIf="field.fieldType === 'LOOKUP_TABLE'" class="custom-dropdown">
                                <div class="dropdown-selected"
                                    (click)="dynamicFieldsService.toggleDynamicDropdown(field, $event)">
                                    <span>{{ dynamicFieldsService.getSelectedDisplayText(field) }}</span>
                                    <i class="fa-solid fa-chevron-down dropdown-arrow"
                                        [class.rotate]="field.isDropdownOpen"></i>
                                </div>
                                <div class="dropdown-options" *ngIf="field.isDropdownOpen">
                                    <div class="dropdown-option" *ngFor="let option of field.options"
                                        (click)="dynamicFieldsService.selectDynamicOption(field, option, $event)">
                                        {{ option.displayText || option.name || option }}
                                    </div>
                                    <div class="dropdown-option text-muted"
                                        *ngIf="!field.options || field.options.length === 0">
                                        No options available
                                    </div>
                                </div>
                            </div>

                            <!-- Lookup Enum Dropdown -->
                            <div *ngIf="field.fieldType === 'LOOKUP_ENUM'" class="custom-dropdown">
                                <div class="dropdown-selected"
                                    (click)="dynamicFieldsService.toggleDynamicDropdown(field, $event)">
                                    <span>{{ dynamicFieldsService.dynamicFieldsData[field.fieldCode] || 'Select ' +
                                        field.label }}</span>
                                    <i class="fa-solid fa-chevron-down dropdown-arrow"
                                        [class.rotate]="field.isDropdownOpen"></i>
                                </div>
                                <div class="dropdown-options" *ngIf="field.isDropdownOpen">
                                    <div class="dropdown-option" *ngFor="let enumValue of field.enumValues"
                                        (click)="dynamicFieldsService.selectDynamicOption(field, enumValue, $event)">
                                        {{ enumValue }}
                                    </div>
                                    <div class="dropdown-option text-muted"
                                        *ngIf="!field.enumValues || field.enumValues.length === 0">
                                        No options available
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </form>
        </div>

        <!-- Horizontal Tabs for ROW fields -->
        <div class="horizontal-tabs" *ngIf="sidebarTabs.length > 0">
            <div class="tabs-container">
                <button *ngFor="let tab of sidebarTabs" class="tab-button" [class.active]="activeTabId === tab.id"
                    (click)="setActiveTab(tab.id)">
                    {{ tab.name }}
                </button>
            </div>
        </div>

        <!-- ROW TABLE TABS Content -->
        <div *ngIf="sidebarTabs[activeTabId - 1]?.rowTableField" class="form-section tab-content-section">
            <form class="section-form">
                <h3 class="section-heading">{{ sidebarTabs[activeTabId - 1]?.name }}</h3>

                <div class="alert alert-warning"
                    *ngIf="!sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns || sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns.length === 0">
                    <i class="fa fa-exclamation-triangle"></i> No row columns found for this table.
                </div>

                <div class="form-row"
                    *ngIf="sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns && sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns.length > 0">
                    <ng-container *ngFor="let column of sidebarTabs[activeTabId - 1]?.rowTableField?.rowColumns">
                        <div class="form-group">
                            <label class="input-label">
                                {{ column.label || column.name }}
                                <span class="required" *ngIf="column.required">*</span>
                            </label>

                            <!-- String Input -->
                            <input *ngIf="column.fieldType === 'STRING'" type="text" class="form-input"
                                [placeholder]="'Enter ' + (column.label || column.name)"
                                [(ngModel)]="column.selectedValue" [name]="column.fieldCode"
                                [attr.maxlength]="column.maxLength">

                            <!-- Number Input -->
                            <input *ngIf="column.fieldType === 'NUMBER'" type="number" class="form-input"
                                [placeholder]="'Enter ' + (column.label || column.name)"
                                [(ngModel)]="column.selectedValue" [name]="column.fieldCode">
                            <!-- DECIMAL Input -->

                            <input *ngIf="column.fieldType === 'DECIMAL'" type="number" step="any" class="form-input"
                                [placeholder]="'Enter ' + (column.label || column.name)"
                                [(ngModel)]="column.selectedValue" [name]="column.fieldCode">
                            <!-- Date Input -->
                            <input *ngIf="column.fieldType === 'DATE'" type="date" class="form-input"
                                [(ngModel)]="column.selectedValue" [name]="column.fieldCode">

                            <!-- Email Input -->
                            <input *ngIf="column.fieldType === 'EMAIL'" type="email" class="form-input"
                                [placeholder]="'Enter ' + (column.label || column.name)"
                                [(ngModel)]="column.selectedValue" [name]="column.fieldCode">

                            <!-- Phone Input -->
                            <input *ngIf="column.fieldType === 'PHONE'" type="tel" class="form-input"
                                [placeholder]="'Enter ' + (column.label || column.name)"
                                [(ngModel)]="column.selectedValue" [name]="column.fieldCode">

                            <!-- URL Input -->
                            <input *ngIf="column.fieldType === 'URL'" type="url" class="form-input"
                                [placeholder]="'Enter ' + (column.label || column.name)"
                                [(ngModel)]="column.selectedValue" [name]="column.fieldCode">

                            <!-- Textarea -->
                            <textarea *ngIf="column.fieldType === 'TEXTAREA'" class="form-input" rows="3"
                                [placeholder]="'Enter ' + (column.label || column.name)"
                                [(ngModel)]="column.selectedValue" [name]="column.fieldCode"
                                [attr.maxlength]="column.maxLength"></textarea>

                            <!-- Boolean Checkbox -->
                            <div *ngIf="column.fieldType === 'BOOLEAN'" class="checkbox-label">
                                <input class="checkbox-input" type="checkbox" [(ngModel)]="column.selectedValue"
                                    [name]="column.fieldCode" [id]="'row_' + column.fieldCode">
                                <span class="checkbox-text">{{ column.label }}</span>
                            </div>

                            <!-- Lookup Table Dropdown -->
                            <div *ngIf="column.fieldType === 'LOOKUP_TABLE'" class="custom-dropdown">
                                <div class="dropdown-selected"
                                    (click)="dynamicFieldsService.toggleRowColumnDropdown(column, $event)">
                                    <span>{{ dynamicFieldsService.getRowColumnDisplayText(column) }}</span>
                                    <i class="fa-solid fa-chevron-down dropdown-arrow"
                                        [class.rotate]="column.isDropdownOpen"></i>
                                </div>
                                <div class="dropdown-options" *ngIf="column.isDropdownOpen">
                                    <div class="dropdown-option" *ngFor="let option of column.options"
                                        (click)="dynamicFieldsService.selectRowColumnOption(column, option, $event)">
                                        {{ option.displayText || option.name || option }}
                                    </div>
                                    <div class="dropdown-option text-muted"
                                        *ngIf="!column.options || column.options.length === 0">
                                        No options available
                                    </div>
                                </div>
                            </div>

                            <!-- Lookup Enum Dropdown -->
                            <div *ngIf="column.fieldType === 'LOOKUP_ENUM'" class="custom-dropdown">
                                <div class="dropdown-selected"
                                    (click)="dynamicFieldsService.toggleRowColumnDropdown(column, $event)">
                                    <span>{{ column.selectedValue || 'Select ' + (column.label || column.name) }}</span>
                                    <i class="fa-solid fa-chevron-down dropdown-arrow"
                                        [class.rotate]="column.isDropdownOpen"></i>
                                </div>
                                <div class="dropdown-options" *ngIf="column.isDropdownOpen">
                                    <div class="dropdown-option" *ngFor="let enumValue of column.enumValues"
                                        (click)="dynamicFieldsService.selectRowColumnOption(column, enumValue, $event)">
                                        {{ enumValue }}
                                    </div>
                                    <div class="dropdown-option text-muted"
                                        *ngIf="!column.enumValues || column.enumValues.length === 0">
                                        No options available
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </form>
        </div>


        <!-- Action Buttons -->
        <div class="form-actions">
            <button type="button" class="btn btn-cancel" (click)="onCancel()">
                Cancel
            </button>
            <button type="button" class="btn btn-submit" (click)="saveFinalScreening()">Save Candidate</button>
        </div>

    </div>
</div>